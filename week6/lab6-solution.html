<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-03-09 Thu 19:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lab5 Solution Amirlan Sharipov (BS21-CS-01)</title>
<meta name="author" content="Amirlan Sharipov (BS21-CS-01)" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Lab5 Solution Amirlan Sharipov (BS21-CS-01)</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgb4a8d53">1. Question 1</a>
<ul>
<li><a href="#orgb9d88ac">1.1. What is a zombie process</a></li>
<li><a href="#org266fff4">1.2. Finding zombie processes</a></li>
<li><a href="#org459fc7a">1.3. kill vs killall vs pkill</a></li>
<li><a href="#org5ff0fe7">1.4. top</a></li>
<li><a href="#org83cfe45">1.5. kill fun processes script</a></li>
<li><a href="#org48d69a8">1.6. Hello world</a></li>
<li><a href="#org96feea4">1.7. System util</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgb4a8d53" class="outline-2">
<h2 id="orgb4a8d53"><span class="section-number-2">1.</span> Question 1</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgb9d88ac" class="outline-3">
<h3 id="orgb9d88ac"><span class="section-number-3">1.1.</span> What is a zombie process</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Zombie processes appear in parent-child process relationships. They are finished executing, but they are still in the process table. For example, when a child process finishes executing, but parent process didn&rsquo;t acknowledge it yet.
</p>
</div>
</div>
<div id="outline-container-org266fff4" class="outline-3">
<h3 id="org266fff4"><span class="section-number-3">1.2.</span> Finding zombie processes</h3>
<div class="outline-text-3" id="text-1-2">
<p>
I created a zombie process using C and then run this command:
</p>
<div class="org-src-container">
<pre class="src src-bash">bat zombie.c
gcc zombie.c
./a.out &amp;
ps aux | <span style="color: #c792ea;">grep</span> <span style="color: #c3e88d;">"defunct"</span> | <span style="color: #c792ea;">grep</span> -v <span style="color: #c3e88d;">"</span><span style="color: #c3e88d;">grep</span><span style="color: #c3e88d;">"</span>
</pre>
</div>

<pre class="example" id="org9746a26">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

int main() {
	pid_t p = fork();
	if (p == 0) {
		exit(0);
	} else {
		sleep(10);
	}
}
rinri     810248  0.0  0.0      0     0 ?        Z    19:11   0:00 [a.out] &lt;defunct&gt;
</pre>
<p>
So, using the last command I can find zombie processes. Let&rsquo;s say that I know that there is only one zombie process. To kill it, let&rsquo;s kill its parent process:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #c792ea;">kill</span> -9 $<span style="color: #c792ea;">(</span>ps -o <span style="color: #ffcb6b;">ppid</span>= -p $<span style="color: #f78c6c;">(</span>ps aux | <span style="color: #c792ea;">grep</span> -m <span style="color: #f78c6c; font-weight: bold;">1</span> <span style="color: #c3e88d;">"defunct"</span> | <span style="color: #c792ea;">grep</span> -v <span style="color: #c3e88d;">"</span><span style="color: #c3e88d;">grep</span><span style="color: #c3e88d;">"</span> | awk <span style="color: #c3e88d;">'{print $2;}'</span><span style="color: #f78c6c;">)</span><span style="color: #c792ea;">)</span>
</pre>
</div>

<p>
By using this line, it&rsquo;s possible to create script to kill all the zombie processes.
</p>
</div>
</div>

<div id="outline-container-org459fc7a" class="outline-3">
<h3 id="org459fc7a"><span class="section-number-3">1.3.</span> kill vs killall vs pkill</h3>
<div class="outline-text-3" id="text-1-3">
<p>
kill sends the specified signal to the given pid.
killall sends the specified signal to all the processes by the given process name.
pkill sends the specified signal to all the processes matching the given pattern.
</p>
</div>
</div>

<div id="outline-container-org5ff0fe7" class="outline-3">
<h3 id="org5ff0fe7"><span class="section-number-3">1.4.</span> top</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-bash">top -b -n <span style="color: #f78c6c; font-weight: bold;">1</span> | head -n <span style="color: #f78c6c; font-weight: bold;">5</span>
</pre>
</div>

<pre class="example">
top - 19:12:03 up  2:35,  1 user,  load average: 2.29, 2.75, 2.98
Tasks: 299 total,   1 running, 298 sleeping,   0 stopped,   0 zombie
%Cpu(s): 17.4 us,  6.5 sy,  0.0 ni, 73.2 id,  0.0 wa,  0.0 hi,  2.9 si,  0.0 st
MiB Mem :  14886.6 total,   6722.9 free,   4607.7 used,   3556.0 buff/cache
MiB Swap:   8243.0 total,   8243.0 free,      0.0 used.   9791.8 avail Mem 
</pre>

<p>
(Explaining the first evaluation, results may differ after export)
The Tasks line says, that there is 283 total processes, 1 of them is currently running, others are sleeping. No stopeed and no zombie processes.
The %Cpu(s) line says about processor utilization.
(Taken from the Lab6 file)
    us is the percent of time spent running user processes.
    sy is the percent of time spent running the kernel.
    ni is the percent of time spent running processes with manually configured nice values.
    id is the percent of time idle (if high, CPU may be overworked).
    wa is the percent of wait time (if high, CPU is waiting for I/O access).
    hi is the percent of time managing hardware interrupts.
    si is the percent of time managing software interrupts.
    st is the percent of virtual CPU time waiting for access to physical CPU.
    Values such as id, wa, and st help identify whether the system is overworked.
</p>
</div>
</div>

<div id="outline-container-org83cfe45" class="outline-3">
<h3 id="org83cfe45"><span class="section-number-3">1.5.</span> kill fun processes script</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">
<pre class="src src-bash">bash -c <span style="color: #c3e88d;">"exec -a fun</span><span style="color: #f78c6c;">$</span><span style="color: #ffcb6b;">{RANDOM}</span><span style="color: #c3e88d;">process </span><span style="color: #c3e88d;">sleep</span><span style="color: #c3e88d;"> infinity"</span> &amp;
bash -c <span style="color: #c3e88d;">"exec -a fun</span><span style="color: #f78c6c;">$</span><span style="color: #ffcb6b;">{RANDOM}</span><span style="color: #c3e88d;">process </span><span style="color: #c3e88d;">sleep</span><span style="color: #c3e88d;"> infinity"</span> &amp;
bash -c <span style="color: #c3e88d;">"exec -a fun</span><span style="color: #f78c6c;">$</span><span style="color: #ffcb6b;">{RANDOM}</span><span style="color: #c3e88d;">process </span><span style="color: #c3e88d;">sleep</span><span style="color: #c3e88d;"> infinity"</span> &amp;

<span style="color: #ffcb6b;">FUNPROCS</span>=<span style="color: #c3e88d;">"</span><span style="color: #89DDFF; font-weight: bold;">$(</span><span style="color: #89DDFF; font-weight: bold;">pgrep</span><span style="color: #89DDFF; font-weight: bold;"> -f 'fun.*process.*infinity')</span><span style="color: #c3e88d;">"</span>
<span style="color: #c792ea;">echo</span> <span style="color: #c3e88d;">"Found </span><span style="color: #89DDFF; font-weight: bold;">$(</span><span style="color: #89DDFF; font-weight: bold;">echo</span><span style="color: #89DDFF; font-weight: bold;"> "</span><span style="color: #89DDFF; font-weight: bold;">$</span><span style="color: #89DDFF; font-weight: bold;">FUNPROCS</span><span style="color: #89DDFF; font-weight: bold;">" | wc -l)</span><span style="color: #c3e88d;"> processes:"</span>
<span style="color: #c792ea;">echo</span> <span style="color: #c3e88d;">"</span><span style="color: #f78c6c;">$</span><span style="color: #ffcb6b;">FUNPROCS</span><span style="color: #c3e88d;">"</span>
<span style="color: #89DDFF;">for</span> FUNPROC<span style="color: #89DDFF;"> in</span> $<span style="color: #ffcb6b;">FUNPROCS</span>
<span style="color: #89DDFF;">do</span>
    <span style="color: #c792ea;">kill</span> -9 <span style="color: #c3e88d;">"</span><span style="color: #f78c6c;">$</span><span style="color: #ffcb6b;">FUNPROC</span><span style="color: #c3e88d;">"</span>
    <span style="color: #c792ea;">echo</span> <span style="color: #c3e88d;">"killed </span><span style="color: #f78c6c;">$</span><span style="color: #ffcb6b;">FUNPROC</span><span style="color: #c3e88d;">"</span>
<span style="color: #89DDFF;">done</span>
</pre>
</div>

<pre class="example">
Found 3 processes:
811145
811146
811147
killed 811145
killed 811146
killed 811147
</pre>
</div>
</div>
<div id="outline-container-org48d69a8" class="outline-3">
<h3 id="org48d69a8"><span class="section-number-3">1.6.</span> Hello world</h3>
<div class="outline-text-3" id="text-1-6">
<div class="org-src-container">
<pre class="src src-bash">bat helloworld.sh
</pre>
</div>

<pre class="example">
#!/bin/bash

trap 'echo "Interrupt received"; exit' SIGUSR1
while :
do
    echo "Hello World"
    sleep 10
done
</pre>


<p>
To kill:
kill -s SIGUSR1 &ldquo;$(ps aux | grep &rdquo;helloworld.sh&ldquo; | grep -v &rdquo;grep&ldquo; | awk &rsquo;{print $2}&rsquo;)&rdquo;
</p>
</div>
</div>
<div id="outline-container-org96feea4" class="outline-3">
<h3 id="org96feea4"><span class="section-number-3">1.7.</span> System util</h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">
<pre class="src src-bash">bat status.sh
</pre>
</div>

<pre class="example" id="org928686a">
#!/bin/bash

while :
do
    CPUUSAGE="$(top -b - n 1 | grep "Cpu" | awk '{print 100-$8}')%"
    MEMUSAGE="$(free -h | grep "Mem" | awk '{print $3/$2*100}')%"
    # disk usage for root directory
    DISKUSAGE="$(df -h | awk '{ if ($6 == "/")
    print $5;
    }')"

    echo "$(date) CPU: $CPUUSAGE Mem: $MEMUSAGE Disk:$DISKUSAGE" &gt;&gt; /var/log/system_utilization.log
    sleep 15
done
</pre>

<div class="org-src-container">
<pre class="src src-bash">bat /var/log/system_utilization.log
</pre>
</div>

<pre class="example">
Thu Mar  9 07:09:13 PM MSK 2023 CPU: 43.2% Mem: 32.1429% Disk:70%
Thu Mar  9 07:09:29 PM MSK 2023 CPU: 45.7% Mem: 32.1429% Disk:70%
Thu Mar  9 07:09:44 PM MSK 2023 CPU: 34.1% Mem: 32.1429% Disk:70%
Thu Mar  9 07:09:59 PM MSK 2023 CPU: 28.5% Mem: 32.1429% Disk:70%
Thu Mar  9 07:10:14 PM MSK 2023 CPU: 22.5% Mem: 32.1429% Disk:70%
Thu Mar  9 07:10:30 PM MSK 2023 CPU: 34.8% Mem: 32.1429% Disk:70%
Thu Mar  9 07:10:45 PM MSK 2023 CPU: 37.6% Mem: 32.1429% Disk:70%
Thu Mar  9 07:11:00 PM MSK 2023 CPU: 29.8% Mem: 32.1429% Disk:70%
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Amirlan Sharipov (BS21-CS-01)</p>
<p class="date">Created: 2023-03-09 Thu 19:12</p>
</div>
</body>
</html>